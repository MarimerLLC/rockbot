{{- if .Values.secrets.create }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "rockbot.fullname" . }}-secrets
  namespace: {{ .Values.namespace }}
  labels:
    {{- include "rockbot.labels" . | nindent 4 }}
type: Opaque
stringData:
  # ── LLM — three-tier (Balanced is REQUIRED; Low and High are optional) ─────
  # All three tiers accept any OpenAI-compatible endpoint (OpenRouter, Azure OpenAI, Ollama, etc.)
  # Tier selection: user messages → keyword heuristic; patrol → Balanced; dream/research → High
  LLM__Balanced__Endpoint: {{ required "secrets.llm.balanced.endpoint is required" .Values.secrets.llm.balanced.endpoint | quote }}
  LLM__Balanced__ApiKey: {{ required "secrets.llm.balanced.apiKey is required" .Values.secrets.llm.balanced.apiKey | quote }}
  LLM__Balanced__ModelId: {{ required "secrets.llm.balanced.modelId is required" .Values.secrets.llm.balanced.modelId | quote }}
  {{- if .Values.secrets.llm.low.modelId }}
  # Low tier — falls back to Balanced when not configured
  LLM__Low__Endpoint: {{ required "secrets.llm.low.endpoint is required when low.modelId is set" .Values.secrets.llm.low.endpoint | quote }}
  LLM__Low__ApiKey: {{ required "secrets.llm.low.apiKey is required when low.modelId is set" .Values.secrets.llm.low.apiKey | quote }}
  LLM__Low__ModelId: {{ .Values.secrets.llm.low.modelId | quote }}
  {{- end }}
  {{- if .Values.secrets.llm.high.modelId }}
  # High tier — falls back to Balanced when not configured
  LLM__High__Endpoint: {{ required "secrets.llm.high.endpoint is required when high.modelId is set" .Values.secrets.llm.high.endpoint | quote }}
  LLM__High__ApiKey: {{ required "secrets.llm.high.apiKey is required when high.modelId is set" .Values.secrets.llm.high.apiKey | quote }}
  LLM__High__ModelId: {{ .Values.secrets.llm.high.modelId | quote }}
  {{- end }}
  {{- if .Values.secrets.llm.endpoint }}
  # Backward compat — flat keys (remove after all deployments migrated to three-tier)
  LLM__Endpoint: {{ .Values.secrets.llm.endpoint | quote }}
  LLM__ApiKey: {{ .Values.secrets.llm.apiKey | quote }}
  LLM__ModelId: {{ .Values.secrets.llm.modelId | quote }}
  {{- end }}
  # ── Web search ────────────────────────────────────────────────────────────────
  WebTools__ApiKey: {{ required "secrets.webTools.apiKey is required" .Values.secrets.webTools.apiKey | quote }}
  # ── RabbitMQ ──────────────────────────────────────────────────────────────────
  RabbitMq__Password: {{ required "secrets.rabbitmq.password is required" .Values.secrets.rabbitmq.password | quote }}
  {{- if .Values.openrouterMcp.enabled }}
  # ── OpenRouter MCP (management API — separate from the LLM key) ───────────────
  OpenRouter__ApiKey: {{ required "secrets.openRouter.apiKey is required when openrouterMcp.enabled=true" .Values.secrets.openRouter.apiKey | quote }}
  {{- end }}
{{- end }}
