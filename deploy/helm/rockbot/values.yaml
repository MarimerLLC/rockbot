# ── Image pull policy ────────────────────────────────────────────────────────
imagePullPolicy: Always

# ── Namespace ─────────────────────────────────────────────────────────────────
namespace: rockbot

# ── Agent (RockBot.Agent) ─────────────────────────────────────────────────────
agent:
  image:
    repository: rockylhotka/rockbot-agent
    tag: latest
  # Always Recreate — only one agent may run at a time (stateful)
  replicaCount: 1
  # IANA timezone ID injected into every LLM prompt as current date/time context.
  # e.g. "America/Chicago", "Europe/London", "Asia/Tokyo"
  # Defaults to UTC (the k8s node timezone) if unset.
  timezone: "America/Chicago"
  resources:
    requests:
      cpu: 500m
      memory: 512Mi
    limits:
      cpu: "2"
      memory: 2Gi

# ── Blazor UI (RockBot.UserProxy.Blazor) ─────────────────────────────────────
blazor:
  image:
    repository: rockylhotka/rockbot-blazor
    tag: latest
  replicaCount: 1
  resources:
    requests:
      cpu: 100m
      memory: 256Mi
    limits:
      cpu: 500m
      memory: 512Mi
  tailscale:
    # Tailscale hostname — the UI becomes accessible at <hostname> on your tailnet.
    # Requires the Tailscale Kubernetes Operator to be installed.
    hostname: rockbot

# ── RabbitMQ ──────────────────────────────────────────────────────────────────
rabbitmq:
  hostName: ""      # REQUIRED — hostname or k8s service name of your RabbitMQ instance
  port: 5672
  userName: ""      # REQUIRED
  virtualHost: /

# ── Script Manager pod ────────────────────────────────────────────────────────
# Trusted sidecar that owns all pod RBAC in the scripts namespace.
# The agent has no Kubernetes API permissions; it delegates script execution
# to this pod via the RabbitMQ message bus.
manager:
  image:
    repository: rockylhotka/rockbot-scripts-manager
    tag: latest
  replicaCount: 1
  resources:
    requests:
      cpu: 100m
      memory: 128Mi
    limits:
      cpu: 250m
      memory: 256Mi

# ── Ephemeral script runner ───────────────────────────────────────────────────
scripts:
  namespace: rockbot-scripts   # isolated from the main rockbot namespace
  image: python:3.12-slim
  cpuLimit: 500m
  memoryLimit: 256Mi

# ── Persistent storage (Longhorn) ─────────────────────────────────────────────
storage:
  storageClass: longhorn
  # Holds soul.md, directives.md, mcp.json, memory/, skills/, and other agent data
  agentDataSize: 10Gi

# ── Telemetry (OpenTelemetry) ─────────────────────────────────────────────────
telemetry:
  enabled: false
  # OTLP gRPC endpoint — e.g. Grafana Alloy, otel-collector
  otlpEndpoint: ""
  serviceName: rockbot

# ── OpenRouter MCP server ─────────────────────────────────────────────────────
# Standalone MCP server that exposes read-only OpenRouter account and usage
# information (credits, models, keys, generation logs) to the agent.
# The API key is provided via the shared secret (secrets.openRouter.apiKey).
openrouterMcp:
  enabled: false
  image:
    repository: rockylhotka/mcpserver-openrouter
    tag: latest
  replicaCount: 1
  resources:
    requests:
      cpu: 50m
      memory: 64Mi
    limits:
      cpu: 200m
      memory: 256Mi

# ── TodoApp MCP server ────────────────────────────────────────────────────────
# Standalone MCP server that exposes a persistent to-do list to the agent.
# Data is stored in a Longhorn PVC mounted at /data inside the container.
todoappMcp:
  enabled: false
  image:
    repository: rockylhotka/mcpserver-todoapp
    tag: latest
  replicaCount: 1
  storage:
    size: 1Gi
  resources:
    requests:
      cpu: 50m
      memory: 64Mi
    limits:
      cpu: 200m
      memory: 256Mi

# ── Secrets ───────────────────────────────────────────────────────────────────
# create: true  → Helm creates a Secret from the values below (convenient, but
#                  secret values end up in Helm release history — use for dev/test
#                  or seal with helm-secrets / external-secrets for production).
# create: false → Provide existingSecretName pointing to a pre-existing Secret.
#                  The Secret must contain all keys listed under stringData in
#                  templates/secret.yaml.
secrets:
  create: true
  existingSecretName: ""   # used only when create: false

  llm:
    # Three-tier LLM configuration. Balanced is REQUIRED.
    # Low and High are optional — both fall back to Balanced when not configured.
    # Any OpenAI-compatible endpoint works: OpenRouter, Azure OpenAI, local Ollama, etc.
    # Tier selection: user messages → keyword heuristic; patrol → Balanced; dream/research → High
    balanced:
      endpoint: ""          # REQUIRED — base URL of the OpenAI-compatible API
      apiKey: ""            # REQUIRED — API key
      modelId: ""           # REQUIRED — model ID (e.g. anthropic/claude-haiku-4.5)
    low:                    # Optional — fast/cheap model for simple factual questions
      endpoint: ""
      apiKey: ""
      modelId: "google/gemini-3.1-pro-preview"
    high:                   # Optional — powerful model for dream/research/complex tasks
      endpoint: ""
      apiKey: ""
      modelId: "google/gemini-3.1-pro-preview"           # leave empty to fall back to balanced

    # Legacy flat keys — kept for backward compatibility; remove after all deployments migrated
    endpoint: ""
    apiKey: ""
    modelId: ""

  webTools:
    apiKey: ""              # REQUIRED — Brave Search API key

  rabbitmq:
    password: ""            # REQUIRED — RabbitMQ password

  openRouter:
    apiKey: ""              # required when openrouterMcp.enabled=true — OpenRouter management API key
                            # (separate from llm.apiKey — this is the account management key)
